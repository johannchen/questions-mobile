"use strict";angular.module("questionsApp",["ngRoute","ngResource"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("questionsApp").controller("MainCtrl",["$scope","$filter","Question",function(a,b,c){function d(){if(0===a.filteredQuestions.length)alert("no more questions");else{var b=Math.floor(Math.random()*a.filteredQuestions.length);a.mainQuestion=a.filteredQuestions[b],a.readQuestions.push(a.mainQuestion),a.filteredQuestions.splice(b,1)}}function e(){a.readQuestions=[];var b=a.filteredQuestions.length-1;a.mainQuestion=a.filteredQuestions[b],a.readQuestions.push(a.mainQuestion),a.filteredQuestions.splice(b,1)}a.dropdown="",a.selectedAdd=!1,a.selectedAbout=!1,a.selectedQuestion=!0,a.readQuestions=[],a.filteredQuestions=[],a.category="Light",a.questions=c.query({q:'{"approved": true}'},function(){var b=a.questions.length-1;a.mainQuestion=a.questions[b],a.readQuestions.push(a.mainQuestion),a.filteredQuestions=angular.copy(a.questions),a.filteredQuestions.splice(b,1)}),a.refresh=function(){location.reload()},a.changeDropdown=function(){if("Add"===a.dropdown)a.selectedAdd=!0,a.selectedAbout=!1,a.selectedQuestion=!1;else if("About"===a.dropdown)a.selectedAdd=!1,a.selectedAbout=!0,a.selectedQuestion=!1;else if("Light"===a.dropdown||"Deep"===a.dropdown||"Faith"===a.dropdown){var c={category:a.dropdown};a.filteredQuestions=b("filter")(a.questions,c),e(),a.selectedAdd=!1,a.selectedAbout=!1,a.selectedQuestion=!0}else a.filteredQuestions=b("filter")(a.questions,""),e(),a.selectedAdd=!1,a.selectedAbout=!1,a.selectedQuestion=!0},a.nextQuestion=function(){var b=a.readQuestions.indexOf(a.mainQuestion);b===a.readQuestions.length-1?d():a.mainQuestion=a.readQuestions[++b]},a.prevQuestion=function(){var b=a.readQuestions.indexOf(a.mainQuestion);0===b?alert("no more previous question."):a.mainQuestion=a.readQuestions[--b]},a.submitQuestion=function(){var b={question:a.question,category:a.category,approved:!1,popularity:1,created_at:new Date};c.save(b,function(){alert("Thank you for the new question. It's waiting for approval.")}),a.question=""}}]),angular.module("questionsApp").factory("Question",["$resource",function a(b){var a=b("https://api.mongolab.com/api/1/databases/question/collections/questions/:id",{apiKey:"50983e52e4b0200e9ba50a55"},{update:{method:"PUT"}});return a.prototype.update=function(b){return a.update({id:this._id.$oid},angular.extend({},this,{_id:void 0}),b)},a.prototype.destroy=function(b){return a.remove({id:this._id.$oid},b)},a}]),angular.module("questionsApp").controller("AdminCtrl",["$scope","Question",function(a,b){a.header="Waiting for approval",a.approved=!1,a.statusFilter={approved:!1},a.questions=b.query(),a.filterApproved=function(){a.approved?(a.statusFilter={approved:!1},a.header="Waiting for approval"):(a.statusFilter={approved:!0},a.header="Approved")},a.deleteQuestion=function(b){confirm("Are you sure to remove this question?")&&b.destroy(function(){var c=a.questions.indexOf(b);a.questions.splice(c,1)})},a.approve=function(a){a.approved=!0;var b=new Date;a.created_at=b.toString(),a.update(function(){console.log("approved question")})},a.updateQuestion=function(a){var b=new Date;a.created_at=b.toString(),a.update(function(){console.log("updated question")}),this.editing=!1},a.showEditForm=function(){this.editing=!0},a.hideEditForm=function(){this.editing=!1}}]);